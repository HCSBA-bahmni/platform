{
  "name": "Search Patient by id",
  "endpoint": {
    "pattern": "/fhir/Patient/:patientId",
    "method": "GET"
  },
  "transformation": {
    "input": "JSON",
    "output": "JSON"
  },
  "inputTransforms": {
    "id": "lookupRequests.jempiSearch.data.uid",
    "gender": "$exists(lookupRequests.jempiSearch.data.demographicData.gender) ? lookupRequests.jempiSearch.data.demographicData.gender : null",
    "birthDate": "$exists(lookupRequests.jempiSearch.data.demographicData.dob) ? lookupRequests.jempiSearch.data.demographicData.dob : null",
    "name": "$exists(lookupRequests.jempiSearch.data.demographicData.givenName) ? lookupRequests.jempiSearch.data.demographicData.givenName : null",
    "lastName": "$exists(lookupRequests.jempiSearch.data.demographicData.familyName) ? lookupRequests.jempiSearch.data.demographicData.familyName : null",
    "city": "$exists(lookupRequests.jempiSearch.data.demographicData.city) ? lookupRequests.jempiSearch.data.demographicData.city : null",
    "identifierValue": "$exists(lookupRequests.jempiSearch.data.sourceId) and $exists(lookupRequests.jempiSearch.data.sourceId.patient) ? lookupRequests.jempiSearch.data.sourceId.patient : null",
    "identifierSystem": "$exists(lookupRequests.jempiSearch.data.sourceId) and $exists(lookupRequests.jempiSearch.data.sourceId.facility) ? lookupRequests.jempiSearch.data.sourceId.facility : null",
    "nationalId": "$exists(lookupRequests.jempiSearch.data.demographicData.nationalId) ? {'value': lookupRequests.jempiSearch.data.demographicData.nationalId, 'system': constants.nidSystem} : null",
    "phoneNumber": "$exists(lookupRequests.jempiSearch.data.demographicData.phoneNumber) ? {'value': lookupRequests.jempiSearch.data.demographicData.phoneNumber, 'system': constants.phone} : null"
  },
  "inputMapping": {
    "constants.resourceType": "resourceType",
    "transforms.id": "id",
    "transforms.gender": "gender",
    "transforms.birthDate": "birthDate",
    "transforms.lastName": "name[0].family",
    "transforms.name": "name[0].given[0]",
    "transforms.city": "address[0].city",
    "transforms.identifierSystem": "identifier[0].system",
    "transforms.identifierValue": "identifier[0].value",
    "transforms.nationalId": "identifier[]+",
    "transforms.phoneNumber": "telecom[]+"
  },
  "constants": {
    "nidSystem": "NationalID",
    "resourceType": "Patient",
    "phone": "phone"
  },
  "requests": {
    "lookup": {
      "id": "jempiSearch",
      "config": {
        "method": "get",
        "url": "http://jempi-api:50000/JeMPI/interaction/:patientId",
        "params": {
          "url": {
            "patientId": {
              "path": "urlParams.patientId"
            }
          }
        }
      }
    }
  }
}
